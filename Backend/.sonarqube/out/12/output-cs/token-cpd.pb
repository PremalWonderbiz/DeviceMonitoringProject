˜
‹C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\GatewayService\GatewayService\API\RealTime\GatewayHub.cs
	namespace 	
API
 
. 
RealTime 
{ 
public 

class 

GatewayHub 
: 
Hub !
{ 
public		 
async		 
Task		 
BroadcastUpdate		 )
(		) *
string		* 0
message		1 8
)		8 9
{

 	
await 
Clients 
. 
All 
. 
	SendAsync '
(' (
$str( 7
,7 8
message9 @
)@ A
;A B
} 	
public 
async 
Task 
JoinDeviceGroup )
() *
string* 0
deviceId1 9
)9 :
{ 	
await 
Groups 
. 
AddToGroupAsync (
(( )
Context) 0
.0 1
ConnectionId1 =
,= >
$"? A
$strA H
{H I
deviceIdI Q
}Q R
"R S
)S T
;T U
} 	
public 
async 
Task 
LeaveDeviceGroup *
(* +
string+ 1
deviceId2 :
): ;
{ 	
await 
Groups 
.  
RemoveFromGroupAsync -
(- .
Context. 5
.5 6
ConnectionId6 B
,B C
$"D F
$strF M
{M N
deviceIdN V
}V W
"W X
)X Y
;Y Z
} 	
public 
async 
Task 
JoinAlarmPanelGroup -
(- .
string. 4
	groupName5 >
)> ?
{ 	
await 
Groups 
. 
AddToGroupAsync (
(( )
Context) 0
.0 1
ConnectionId1 =
,= >
$"? A
{A B
	groupNameB K
}K L
"L M
)M N
;N O
} 	
public 
async 
Task  
LeaveAlarmPanelGroup .
(. /
string/ 5
	groupName6 ?
)? @
{   	
await!! 
Groups!! 
.!!  
RemoveFromGroupAsync!! -
(!!- .
Context!!. 5
.!!5 6
ConnectionId!!6 B
,!!B C
$"!!D F
{!!F G
	groupName!!G P
}!!P Q
"!!Q R
)!!R S
;!!S T
}"" 	
public$$ 
async$$ 
Task$$ "
JoinPropertyPanelGroup$$ 0
($$0 1
string$$1 7
deviceId$$8 @
)$$@ A
{%% 	
await&& 
Groups&& 
.&& 
AddToGroupAsync&& (
(&&( )
Context&&) 0
.&&0 1
ConnectionId&&1 =
,&&= >
$"&&? A
$str&&A G
{&&G H
deviceId&&H P
}&&P Q
"&&Q R
)&&R S
;&&S T
}'' 	
public)) 
async)) 
Task)) #
LeavePropertyPanelGroup)) 1
())1 2
string))2 8
deviceId))9 A
)))A B
{** 	
await++ 
Groups++ 
.++  
RemoveFromGroupAsync++ -
(++- .
Context++. 5
.++5 6
ConnectionId++6 B
,++B C
$"++D F
$str++F L
{++L M
deviceId++M U
}++U V
"++V W
)++W X
;++X Y
},, 	
}-- 
}.. ¸
C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\GatewayService\GatewayService\API\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddControllers

 
(

  
)

  !
;

! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
builder 
. 
Services 
. 

AddSignalR 
( 
) 
; 
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( 
$str "
," #
policy 
=> 
policy 
. 
AllowAnyMethod 
( 
) 
. 
AllowAnyHeader 
( 
) 
. 
SetIsOriginAllowed 
(  
_  !
=>" $
true% )
)) *
. 
AllowCredentials 
( 
) 
)  
;  !
} 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app   
.   

UseSwagger   
(   
)   
;   
app!! 
.!! 
UseSwaggerUI!! 
(!! 
)!! 
;!! 
}"" 
app$$ 
.$$ 
UseHttpsRedirection$$ 
($$ 
)$$ 
;$$ 
app&& 
.&& 
UseAuthorization&& 
(&& 
)&& 
;&& 
app(( 
.(( 
MapControllers(( 
((( 
)(( 
;(( 
app** 
.** 
MapHub** 

<**
 

GatewayHub** 
>** 
(** 
$str** $
)**$ %
;**% &
app,, 
.,, 
UseCors,, 
(,, 
$str,, 
),, 
;,, 
app.. 
... 
Run.. 
(.. 
).. 	
;..	 
è.
–C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\GatewayService\GatewayService\API\Controllers\RealtimeController.cs
	namespace 	
API
 
. 
Controllers 
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
RealtimeController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
IHubContext $
<$ %

GatewayHub% /
>/ 0
_hubContext1 <
;< =
public 
RealtimeController !
(! "
IHubContext" -
<- .

GatewayHub. 8
>8 9

hubContext: D
)D E
{ 	
_hubContext 
= 

hubContext $
;$ %
} 	
[ 	
HttpPost	 
( 
$str !
)! "
]" #
public 
async 
Task 
< 
IActionResult '
>' (
SendDeviceUpdate) 9
(9 :
[: ;
FromBody; C
]C D
JsonElementE P
jsonQ U
)U V
{ 	
var 
rawJson 
= 
json 
. 

GetRawText )
() *
)* +
;+ ,
await 
_hubContext 
. 
Clients %
.% &
All& )
.) *
	SendAsync* 3
(3 4
$str4 C
,C D
rawJsonE L
)L M
;M N
return 
Ok 
( 
) 
; 
} 	
[ 	
HttpPost	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
IActionResult '
>' (
SendAlarmUpdate) 8
(8 9
[9 :
FromBody: B
]B C
JsonElementD O
jsonP T
)T U
{ 	
var 
rawJson 
= 
json 
. 

GetRawText )
() *
)* +
;+ ,
await   
_hubContext   
.   
Clients   %
.  % &
All  & )
.  ) *
	SendAsync  * 3
(  3 4
$str  4 L
,  L M
rawJson  N U
)  U V
;  V W
return!! 
Ok!! 
(!! 
)!! 
;!! 
}"" 	
[$$ 	
HttpPost$$	 
($$ 
$str$$ 2
)$$2 3
]$$3 4
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (!
SendDeviceGroupUpdate%%) >
(%%> ?
string%%? E
deviceId%%F N
,%%N O
[%%P Q
FromBody%%Q Y
]%%Y Z
JsonElement%%[ f
json%%g k
)%%k l
{&& 	
var'' 
rawJson'' 
='' 
json'' 
.'' 

GetRawText'' )
('') *
)''* +
;''+ ,
await(( 
_hubContext(( 
.(( 
Clients(( %
.((% &
Group((& +
(((+ ,
$"((, .
$str((. 5
{((5 6
deviceId((6 >
}((> ?
"((? @
)((@ A
.((A B
	SendAsync((B K
(((K L
$"((L N
$str((N [
{(([ \
deviceId((\ d
}((d e
"((e f
,((f g
rawJson((h o
)((o p
;((p q
return)) 
Ok)) 
()) 
))) 
;)) 
}** 	
[,, 	
HttpPost,,	 
(,, 
$str,, +
),,+ ,
],,, -
public-- 
async-- 
Task-- 
<-- 
IActionResult-- '
>--' (%
SendAlarmPanelGroupUpdate--) B
(--B C
[--C D
FromBody--D L
]--L M
JsonElement--N Y
json--Z ^
)--^ _
{.. 	
var// 
rawJson// 
=// 
json// 
.// 

GetRawText// )
(//) *
)//* +
;//+ ,
await00 
_hubContext00 
.00 
Clients00 %
.00% &
Group00& +
(00+ ,
$"00, .
$str00. =
"00= >
)00> ?
.00? @
	SendAsync00@ I
(00I J
$str00J d
,00d e
rawJson00f m
)00m n
;00n o
return11 
Ok11 
(11 
)11 
;11 
}22 	
[44 	
HttpPost44	 
(44 
$str44 9
)449 :
]44: ;
public55 
async55 
Task55 
<55 
IActionResult55 '
>55' ( 
SendAlarmGroupUpdate55) =
(55= >
string55> D
deviceId55E M
,55M N
[55O P
FromBody55P X
]55X Y
JsonElement55Z e
json55f j
)55j k
{66 	
var77 
rawJson77 
=77 
json77 
.77 

GetRawText77 )
(77) *
)77* +
;77+ ,
await88 
_hubContext88 
.88 
Clients88 %
.88% &
Group88& +
(88+ ,
$"88, .
$str88. 4
{884 5
deviceId885 =
}88= >
"88> ?
)88? @
.88@ A
	SendAsync88A J
(88J K
$str88K m
,88m n
rawJson88o v
)88v w
;88w x
return99 
Ok99 
(99 
)99 
;99 
}:: 	
};; 
}<< 