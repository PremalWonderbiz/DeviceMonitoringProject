Íú
‡C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\AlarmService\Infrastructure\Services\AlarmService.cs
	namespace 	
Infrastructure
 
. 
Services !
{ 
public 

class 
AlarmService 
: 
IAlarmService  -
{ 
private 
readonly 
AlarmDbContext '
_context( 0
;0 1
private 
readonly 
AlertService %
_alertService& 3
;3 4
public 
AlarmService 
( 
AlarmDbContext *
context+ 2
,2 3
AlertService4 @
alertServiceA M
)M N
{ 	
_context 
= 
context 
; 
_alertService 
= 
alertService (
;( )
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
GetAlarmDto& 1
>1 2
>2 3
	GetAlarms4 =
(= >
AlarmFilter> I
filterJ P
)P Q
{ 	
var 
alarms 
= 
_context !
.! "
Alarms" (
.( )
Include) 0
(0 1
a1 2
=>3 5
a6 7
.7 8
State8 =
)= >
.> ?
AsQueryable? J
(J K
)K L
;L M
if   
(   
filter   
.   
Devices   
is   !
not  " %
null  & *
&&  + -
filter  . 4
.  4 5
Devices  5 <
.  < =
Count  = B
>  C D
$num  E F
)  F G
alarms!! 
=!! 
alarms!! 
.!!  
Where!!  %
(!!% &
a!!& '
=>!!( *
filter!!+ 1
.!!1 2
Devices!!2 9
.!!9 :
Contains!!: B
(!!B C
a!!C D
.!!D E
SourceDeviceMacId!!E V
)!!V W
)!!W X
;!!X Y
if## 
(## 
filter## 
.## 
FilterDateRange## &
?##& '
.##' (
Length##( .
==##/ 1
$num##2 3
&&##4 6
DateTime$$ 
.$$ 
TryParse$$ !
(%% 
filter%% 
.%%  
FilterDateRange%%  /
[%%/ 0
$num%%0 1
]%%1 2
,%%2 3
CultureInfo&& #
.&&# $
InvariantCulture&&$ 4
,&&4 5
DateTimeStyles'' &
.''& '
AssumeUniversal''' 6
|''7 8
DateTimeStyles''9 G
.''G H
AdjustToUniversal''H Y
,''Y Z
out(( 
var(( 
	startDate((  )
)(() *
&&((+ -
DateTime)) 
.)) 
TryParse)) !
(** 
filter** 
.**  
FilterDateRange**  /
[**/ 0
$num**0 1
]**1 2
,**2 3
CultureInfo++ #
.++# $
InvariantCulture++$ 4
,++4 5
DateTimeStyles,, &
.,,& '
AssumeUniversal,,' 6
|,,7 8
DateTimeStyles,,9 G
.,,G H
AdjustToUniversal,,H Y
,,,Y Z
out-- 
var-- 
endDate--  '
)--' (
)--( )
{.. 
alarms// 
=// 
alarms// 
.//  
Where//  %
(//% &
a//& '
=>//( *
a//+ ,
.//, -
RaisedAt//- 5
>=//6 8
	startDate//9 B
&&//C E
a//F G
.//G H
RaisedAt//H P
<=//Q S
endDate//T [
)//[ \
;//\ ]
}00 
var22 
formattedAlarms22 
=22  !
await22" '
alarms22( .
.22. /
Select22/ 5
(225 6
alarm226 ;
=>22< >
new22? B
GetAlarmDto22C N
{33 
Id44 
=44 
alarm44 
.44 
Id44 
,44 
AcknowledgedAt55 
=55  
alarm55! &
.55& '
AcknowledgedAt55' 5
,555 6
IsAcknowledged66 
=66  
alarm66! &
.66& '
IsAcknowledged66' 5
,665 6
Message77 
=77 
alarm77 
.77  
Message77  '
,77' (
RaisedAt88 
=88 
alarm88  
.88  !
RaisedAt88! )
.88) *
ToLocalTime88* 5
(885 6
)886 7
,887 8
Severity99 
=99 
alarm99  
.99  !
Severity99! )
.99) *
ToString99* 2
(992 3
)993 4
,994 5
SourceDeviceMacId:: !
=::" #
alarm::$ )
.::) *
SourceDeviceMacId::* ;
,::; <

AlarmState;; 
=;; 
alarm;; "
.;;" #
State;;# (
.;;( )
Name;;) -
,;;- .
AlarmComment<< 
=<< 
alarm<< $
.<<$ %
Comment<<% ,
,<<, -
AcknowledgedFrom==  
===! "
alarm==# (
.==( )
AcknowledgedFrom==) 9
}>> 
)>> 
.>> 
ToListAsync>> 
(>> 
)>> 
;>> 
return@@ 
formattedAlarms@@ "
;@@" #
}AA 	
publicCC 
asyncCC 
TaskCC 
<CC 
GetAlarmDtoCC %
>CC% &
GetAlarmCC' /
(CC/ 0
GuidCC0 4
idCC5 7
)CC7 8
{DD 	
varEE 
alarmEE 
=EE 
awaitEE 
_contextEE &
.EE& '
AlarmsEE' -
.EE- .
	FindAsyncEE. 7
(EE7 8
idEE8 :
)EE: ;
;EE; <
ifGG 
(GG 
alarmGG 
==GG 
nullGG 
)GG 
throwHH 
newHH 
CustomExceptionHH )
(HH) *
$numHH* -
,HH- .
$strHH/ @
)HH@ A
;HHA B
returnJJ 
newJJ 
GetAlarmDtoJJ "
{KK 
IdLL 
=LL 
alarmLL 
.LL 
IdLL 
,LL 
AcknowledgedAtMM 
=MM  
alarmMM! &
.MM& '
AcknowledgedAtMM' 5
?MM5 6
.MM6 7
ToLocalTimeMM7 B
(MMB C
)MMC D
,MMD E
IsAcknowledgedNN 
=NN  
alarmNN! &
.NN& '
IsAcknowledgedNN' 5
,NN5 6
MessageOO 
=OO 
alarmOO 
.OO  
MessageOO  '
,OO' (
RaisedAtPP 
=PP 
alarmPP  
.PP  !
RaisedAtPP! )
.PP) *
ToLocalTimePP* 5
(PP5 6
)PP6 7
,PP7 8
SeverityQQ 
=QQ 
alarmQQ  
.QQ  !
SeverityQQ! )
.QQ) *
ToStringQQ* 2
(QQ2 3
)QQ3 4
,QQ4 5
SourceDeviceMacIdRR !
=RR" #
alarmRR$ )
.RR) *
SourceDeviceMacIdRR* ;
}SS 
;SS 
}TT 	
publicVV 
asyncVV 
TaskVV 
<VV 
stringVV  
>VV  !
PutAlarmVV" *
(VV* +
GuidVV+ /
idVV0 2
,VV2 3
AlarmVV4 9
alarmVV: ?
)VV? @
{WW 	
ifXX 
(XX 
idXX 
!=XX 
alarmXX 
.XX 
IdXX 
)XX 
throwYY 
newYY 
CustomExceptionYY )
(YY) *
$numYY* -
,YY- .
$strYY/ G
)YYG H
;YYH I
_context[[ 
.[[ 
Entry[[ 
([[ 
alarm[[  
)[[  !
.[[! "
State[[" '
=[[( )
EntityState[[* 5
.[[5 6
Modified[[6 >
;[[> ?
try]] 
{^^ 
await__ 
_context__ 
.__ 
SaveChangesAsync__ /
(__/ 0
)__0 1
;__1 2
}`` 
catchaa 
(aa (
DbUpdateConcurrencyExceptionaa /
)aa/ 0
{bb 
ifcc 
(cc 
!cc 
AlarmExistscc  
(cc  !
idcc! #
)cc# $
)cc$ %
{dd 
throwee 
newee 
CustomExceptionee -
(ee- .
$numee. 1
,ee1 2
$stree3 D
)eeD E
;eeE F
}ff 
elsegg 
{hh 
throwii 
;ii 
}jj 
}kk 
returnmm 
$strmm /
;mm/ 0
}nn 	
publicpp 
asyncpp 
Taskpp 
<pp 
Alarmpp 
>pp  
	PostAlarmpp! *
(pp* +
PostAlarmDtopp+ 7
alarmDtopp8 @
)pp@ A
{qq 	
varrr 
alarmrr 
=rr 
newrr 
Alarmrr !
{ss 
SourceDeviceMacIdtt !
=tt" #
alarmDtott$ ,
.tt, -
SourceDeviceMacIdtt- >
,tt> ?
Messageuu 
=uu 
alarmDtouu "
.uu" #
Messageuu# *
,uu* +
Severityvv 
=vv 
alarmDtovv #
.vv# $
Severityvv$ ,
}ww 
;ww 
_contextyy 
.yy 
Alarmsyy 
.yy 
Addyy 
(yy  
alarmyy  %
)yy% &
;yy& '
awaitzz 
_contextzz 
.zz 
SaveChangesAsynczz +
(zz+ ,
)zz, -
;zz- .
return|| 
alarm|| 
;|| 
}}} 	
public 
async 
Task 
< 
GetAlarmDto %
>% &
IgnoreAlarm' 2
(2 3
Guid3 7
id8 :
,: ;
string< B
commentC J
)J K
{
€€ 	
var
 
alarm
 
=
 
await
 
_context
 &
.
& '
Alarms
' -
.
- ."
SingleOrDefaultAsync
. B
(
B C
alarm
C H
=>
I K
alarm
L Q
.
Q R
Id
R T
==
U W
id
X Z
)
Z [
;
[ \
if
‚‚ 
(
‚‚ 
alarm
‚‚ 
is
‚‚ 
null
‚‚ 
)
‚‚ 
throw
ƒƒ 
new
ƒƒ 
CustomException
ƒƒ )
(
ƒƒ) *
$num
ƒƒ* -
,
ƒƒ- .
$str
ƒƒ/ @
)
ƒƒ@ A
;
ƒƒA B
if
…… 
(
…… 
alarm
…… 
.
…… 
IsAcknowledged
…… $
is
……% '
false
……( -
)
……- .
{
†† 
alarm
‡‡ 
.
‡‡ 
IsAcknowledged
‡‡ $
=
‡‡% &
true
‡‡' +
;
‡‡+ ,
alarm
ˆˆ 
.
ˆˆ 
AcknowledgedAt
ˆˆ $
=
ˆˆ% &
DateTime
ˆˆ' /
.
ˆˆ/ 0
UtcNow
ˆˆ0 6
;
ˆˆ6 7
alarm
‰‰ 
.
‰‰ 
AcknowledgedFrom
‰‰ &
=
‰‰' (
$str
‰‰) H
;
‰‰H I
}
ŠŠ 
else
‹‹ 
{
ŒŒ 
alarm
 
.
 
AcknowledgedFrom
 &
=
' (
$str
) E
;
E F
}
 
var
 
ignoredState
 
=
 
await
 $
_context
% -
.
- .
AlarmStates
. 9
.
9 :"
SingleOrDefaultAsync
: N
(
N O
alarm
O T
=>
U W
alarm
X ]
.
] ^
Name
^ b
==
c e
$str
f o
)
o p
;
p q
alarm
‘‘ 
.
‘‘ 
StateId
‘‘ 
=
‘‘ 
ignoredState
‘‘ (
?
‘‘( )
.
‘‘) *
Id
‘‘* ,
??
‘‘, .
$num
‘‘. /
;
‘‘/ 0
alarm
’’ 
.
’’ 
Comment
’’ 
=
’’ 
(
’’ 
comment
’’ $
!=
’’% '
$str
’’( 0
&&
’’1 3
comment
’’4 ;
.
’’; <
Length
’’< B
>
’’C D
$num
’’E F
)
’’F G
?
’’H I
comment
’’J Q
:
’’R S
$str
’’T p
;
’’p q
_context
”” 
.
”” 
Entry
”” 
(
”” 
alarm
””  
)
””  !
.
””! "
State
””" '
=
””( )
EntityState
””* 5
.
””5 6
Modified
””6 >
;
””> ?
try
–– 
{
—— 
await
˜˜ 
_context
˜˜ 
.
˜˜ 
SaveChangesAsync
˜˜ /
(
˜˜/ 0
)
˜˜0 1
;
˜˜1 2
}
™™ 
catch
šš 
(
šš *
DbUpdateConcurrencyException
šš /
ex
šš0 2
)
šš2 3
{
›› 
throw
œœ 
new
œœ 
CustomException
œœ )
(
œœ) *
$num
œœ* -
,
œœ- .
ex
œœ/ 1
.
œœ1 2
Message
œœ2 9
)
œœ9 :
;
œœ: ;
}
 
var
ŸŸ 
mainPageUpdates
ŸŸ 
=
ŸŸ  !
await
ŸŸ" '!
GetLatestFiveAlarms
ŸŸ( ;
(
ŸŸ; <
)
ŸŸ< =
;
ŸŸ= >
var
   
serializedData
   
=
    
JsonSerializer
  ! /
.
  / 0
	Serialize
  0 9
(
  9 :
mainPageUpdates
  : I
,
  I J
new
  K N#
JsonSerializerOptions
  O d
{
¡¡ 
Encoder
¢¢ 
=
¢¢ 
JavaScriptEncoder
¢¢ +
.
¢¢+ ,'
UnsafeRelaxedJsonEscaping
¢¢, E
,
¢¢E F
WriteIndented
££ 
=
££ 
true
££  $
,
££$ %"
PropertyNamingPolicy
¤¤ $
=
¤¤% &
JsonNamingPolicy
¤¤' 7
.
¤¤7 8
	CamelCase
¤¤8 A
,
¤¤A B
}
¥¥ 
)
¥¥ 
;
¥¥ 
await
¦¦ 
_alertService
¦¦ 
.
¦¦  
MainPageUpdates
¦¦  /
(
¦¦/ 0
serializedData
¦¦0 >
)
¦¦> ?
;
¦¦? @
try
¨¨ 
{
©© 
var
ªª  
propertyPanelAlarm
ªª &
=
ªª' (
await
ªª) .%
GetLatestAlarmForDevice
ªª/ F
(
ªªF G
alarm
ªªG L
.
ªªL M
SourceDeviceMacId
ªªM ^
)
ªª^ _
;
ªª_ `
await
«« 
_alertService
«« #
.
««# $"
PropertyPanelUpdates
««$ 8
(
««8 9
JsonSerializer
««9 G
.
««G H
	Serialize
««H Q
(
««Q R 
propertyPanelAlarm
««R d
,
««d e
new
««f i#
JsonSerializerOptions
««j 
{
¬¬ 
Encoder
­­ 
=
­­ 
JavaScriptEncoder
­­ /
.
­­/ 0'
UnsafeRelaxedJsonEscaping
­­0 I
,
­­I J"
PropertyNamingPolicy
®® (
=
®®) *
JsonNamingPolicy
®®+ ;
.
®®; <
	CamelCase
®®< E
,
®®E F
WriteIndented
¯¯ !
=
¯¯" #
true
¯¯$ (
}
°° 
)
°° 
,
°° 
alarm
°° 
.
°° 
SourceDeviceMacId
°° +
)
°°+ ,
;
°°, -
}
±± 
catch
²² 
(
²² 
CustomException
²² "
ex
²²# %
)
²²% &
{
³³ 
await
´´ 
_alertService
´´ #
.
´´# $"
PropertyPanelUpdates
´´$ 8
(
´´8 9
$str
´´9 ;
,
´´; <
alarm
´´= B
.
´´B C
SourceDeviceMacId
´´C T
)
´´T U
;
´´U V
}
µµ 
return
·· 
new
·· 
GetAlarmDto
·· "
{
¸¸ 
Id
¹¹ 
=
¹¹ 
alarm
¹¹ 
.
¹¹ 
Id
¹¹ 
,
¹¹ 
AcknowledgedAt
ºº 
=
ºº  
alarm
ºº! &
.
ºº& '
AcknowledgedAt
ºº' 5
?
ºº5 6
.
ºº6 7
ToLocalTime
ºº7 B
(
ººB C
)
ººC D
,
ººD E
IsAcknowledged
»» 
=
»»  
alarm
»»! &
.
»»& '
IsAcknowledged
»»' 5
,
»»5 6
Message
¼¼ 
=
¼¼ 
alarm
¼¼ 
.
¼¼  
Message
¼¼  '
,
¼¼' (
RaisedAt
½½ 
=
½½ 
alarm
½½  
.
½½  !
RaisedAt
½½! )
.
½½) *
ToLocalTime
½½* 5
(
½½5 6
)
½½6 7
,
½½7 8
Severity
¾¾ 
=
¾¾ 
alarm
¾¾  
.
¾¾  !
Severity
¾¾! )
.
¾¾) *
ToString
¾¾* 2
(
¾¾2 3
)
¾¾3 4
,
¾¾4 5
SourceDeviceMacId
¿¿ !
=
¿¿" #
alarm
¿¿$ )
.
¿¿) *
SourceDeviceMacId
¿¿* ;
,
¿¿; <

AlarmState
ÀÀ 
=
ÀÀ 
alarm
ÀÀ "
.
ÀÀ" #
State
ÀÀ# (
.
ÀÀ( )
Name
ÀÀ) -
,
ÀÀ- .
AlarmComment
ÁÁ 
=
ÁÁ 
alarm
ÁÁ $
.
ÁÁ$ %
Comment
ÁÁ% ,
,
ÁÁ, -
AcknowledgedFrom
ÂÂ  
=
ÂÂ! "
alarm
ÂÂ# (
.
ÂÂ( )
AcknowledgedFrom
ÂÂ) 9
}
ÃÃ 
;
ÃÃ 
}
ÄÄ 	
private
ÆÆ 
bool
ÆÆ 
AlarmExists
ÆÆ  
(
ÆÆ  !
Guid
ÆÆ! %
id
ÆÆ& (
)
ÆÆ( )
{
ÇÇ 	
return
ÈÈ 
_context
ÈÈ 
.
ÈÈ 
Alarms
ÈÈ "
.
ÈÈ" #
Any
ÈÈ# &
(
ÈÈ& '
e
ÈÈ' (
=>
ÈÈ) +
e
ÈÈ, -
.
ÈÈ- .
Id
ÈÈ. 0
==
ÈÈ1 3
id
ÈÈ4 6
)
ÈÈ6 7
;
ÈÈ7 8
}
ÉÉ 	
public
ËË 
async
ËË 
Task
ËË 
<
ËË 
IEnumerable
ËË %
<
ËË% &
GetAlarmDto
ËË& 1
>
ËË1 2
>
ËË2 3!
GetAlarmsByDeviceId
ËË4 G
(
ËËG H
string
ËËH N
id
ËËO Q
)
ËËQ R
{
ÌÌ 	
var
ÍÍ 
alarms
ÍÍ 
=
ÍÍ 
await
ÍÍ 
_context
ÍÍ '
.
ÍÍ' (
Alarms
ÍÍ( .
.
ÍÍ. /
Include
ÍÍ/ 6
(
ÍÍ6 7
a
ÍÍ7 8
=>
ÍÍ9 ;
a
ÍÍ< =
.
ÍÍ= >
State
ÍÍ> C
)
ÍÍC D
.
ÍÍD E
ToListAsync
ÍÍE P
(
ÍÍP Q
)
ÍÍQ R
;
ÍÍR S
var
ÏÏ 
formattedAlarms
ÏÏ 
=
ÏÏ  !
new
ÏÏ" %
List
ÏÏ& *
<
ÏÏ* +
GetAlarmDto
ÏÏ+ 6
>
ÏÏ6 7
(
ÏÏ7 8
)
ÏÏ8 9
;
ÏÏ9 :
alarms
ĞĞ 
.
ĞĞ 
ForEach
ĞĞ 
(
ĞĞ 
alarm
ĞĞ  
=>
ĞĞ! #
{
ĞĞ$ %
formattedAlarms
ÑÑ 
.
ÑÑ  
Add
ÑÑ  #
(
ÑÑ# $
new
ÑÑ$ '
GetAlarmDto
ÑÑ( 3
{
ÒÒ 
Id
ÓÓ 
=
ÓÓ 
alarm
ÓÓ 
.
ÓÓ 
Id
ÓÓ !
,
ÓÓ! "
AcknowledgedAt
ÔÔ "
=
ÔÔ# $
alarm
ÔÔ% *
.
ÔÔ* +
AcknowledgedAt
ÔÔ+ 9
?
ÔÔ9 :
.
ÔÔ: ;
ToLocalTime
ÔÔ; F
(
ÔÔF G
)
ÔÔG H
,
ÔÔH I
IsAcknowledged
ÕÕ "
=
ÕÕ# $
alarm
ÕÕ% *
.
ÕÕ* +
IsAcknowledged
ÕÕ+ 9
,
ÕÕ9 :
Message
ÖÖ 
=
ÖÖ 
alarm
ÖÖ #
.
ÖÖ# $
Message
ÖÖ$ +
,
ÖÖ+ ,
RaisedAt
×× 
=
×× 
alarm
×× $
.
××$ %
RaisedAt
××% -
.
××- .
ToLocalTime
××. 9
(
××9 :
)
××: ;
,
××; <
Severity
ØØ 
=
ØØ 
alarm
ØØ $
.
ØØ$ %
Severity
ØØ% -
.
ØØ- .
ToString
ØØ. 6
(
ØØ6 7
)
ØØ7 8
,
ØØ8 9
SourceDeviceMacId
ÙÙ %
=
ÙÙ& '
alarm
ÙÙ( -
.
ÙÙ- .
SourceDeviceMacId
ÙÙ. ?
,
ÙÙ? @

AlarmState
ÚÚ 
=
ÚÚ  
alarm
ÚÚ! &
.
ÚÚ& '
State
ÚÚ' ,
.
ÚÚ, -
Name
ÚÚ- 1
,
ÚÚ1 2
AlarmComment
ÛÛ  
=
ÛÛ! "
alarm
ÛÛ# (
.
ÛÛ( )
Comment
ÛÛ) 0
,
ÛÛ0 1
AcknowledgedFrom
ÜÜ $
=
ÜÜ% &
alarm
ÜÜ' ,
.
ÜÜ, -
AcknowledgedFrom
ÜÜ- =
}
İİ 
)
İİ 
;
İİ 
}
ŞŞ 
)
ŞŞ 
;
ŞŞ 
return
àà 
formattedAlarms
àà "
;
àà" #
}
áá 	
public
ãã 
async
ãã 
Task
ãã 
<
ãã 
GetAlarmDto
ãã %
>
ãã% &
InvestigateAlarm
ãã' 7
(
ãã7 8
Guid
ãã8 <
alarmId
ãã= D
)
ããD E
{
ää 	
var
åå 
alarm
åå 
=
åå 
await
åå 
_context
åå &
.
åå& '
Alarms
åå' -
.
åå- ."
SingleOrDefaultAsync
åå. B
(
ååB C
alarm
ååC H
=>
ååI K
alarm
ååL Q
.
ååQ R
Id
ååR T
==
ååU W
alarmId
ååX _
)
åå_ `
;
åå` a
if
ææ 
(
ææ 
alarm
ææ 
is
ææ 
null
ææ 
)
ææ 
throw
çç 
new
çç 
CustomException
çç )
(
çç) *
$num
çç* -
,
çç- .
$str
çç/ @
)
çç@ A
;
ççA B
alarm
éé 
.
éé 
IsAcknowledged
éé  
=
éé! "
true
éé# '
;
éé' (
alarm
êê 
.
êê 
AcknowledgedAt
êê  
=
êê! "
DateTime
êê# +
.
êê+ ,
UtcNow
êê, 2
;
êê2 3
var
ìì 
investigateState
ìì  
=
ìì! "
await
ìì# (
_context
ìì) 1
.
ìì1 2
AlarmStates
ìì2 =
.
ìì= >"
SingleOrDefaultAsync
ìì> R
(
ììR S
alarm
ììS X
=>
ììY [
alarm
ìì\ a
.
ììa b
Name
ììb f
==
ììg i
$str
ììj y
)
ììy z
;
ììz {
alarm
íí 
.
íí 
StateId
íí 
=
íí 
investigateState
íí ,
?
íí, -
.
íí- .
Id
íí. 0
??
íí1 3
$num
íí4 5
;
íí5 6
alarm
îî 
.
îî 
Comment
îî 
=
îî 
$str
îî 1
;
îî1 2
alarm
ïï 
.
ïï 
AcknowledgedFrom
ïï "
=
ïï# $
$str
ïï% 9
;
ïï9 :
_context
ññ 
.
ññ 
Entry
ññ 
(
ññ 
alarm
ññ  
)
ññ  !
.
ññ! "
State
ññ" '
=
ññ( )
EntityState
ññ* 5
.
ññ5 6
Modified
ññ6 >
;
ññ> ?
try
óó 
{
ôô 
await
õõ 
_context
õõ 
.
õõ 
SaveChangesAsync
õõ /
(
õõ/ 0
)
õõ0 1
;
õõ1 2
}
öö 
catch
÷÷ 
(
÷÷ *
DbUpdateConcurrencyException
÷÷ /
ex
÷÷0 2
)
÷÷2 3
{
øø 
throw
ùù 
new
ùù 
CustomException
ùù )
(
ùù) *
$num
ùù* -
,
ùù- .
ex
ùù/ 1
.
ùù1 2
Message
ùù2 9
)
ùù9 :
;
ùù: ;
}
úú 
return
üü 
new
üü 
GetAlarmDto
üü "
{
ıı 
Id
şş 
=
şş 
alarm
şş 
.
şş 
Id
şş 
,
şş 
AcknowledgedAt
ÿÿ 
=
ÿÿ  
alarm
ÿÿ! &
.
ÿÿ& '
AcknowledgedAt
ÿÿ' 5
?
ÿÿ5 6
.
ÿÿ6 7
ToLocalTime
ÿÿ7 B
(
ÿÿB C
)
ÿÿC D
,
ÿÿD E
IsAcknowledged
€€ 
=
€€  
alarm
€€! &
.
€€& '
IsAcknowledged
€€' 5
,
€€5 6
Message
 
=
 
alarm
 
.
  
Message
  '
,
' (
RaisedAt
‚‚ 
=
‚‚ 
alarm
‚‚  
.
‚‚  !
RaisedAt
‚‚! )
.
‚‚) *
ToLocalTime
‚‚* 5
(
‚‚5 6
)
‚‚6 7
,
‚‚7 8
Severity
ƒƒ 
=
ƒƒ 
alarm
ƒƒ  
.
ƒƒ  !
Severity
ƒƒ! )
.
ƒƒ) *
ToString
ƒƒ* 2
(
ƒƒ2 3
)
ƒƒ3 4
,
ƒƒ4 5
SourceDeviceMacId
„„ !
=
„„" #
alarm
„„$ )
.
„„) *
SourceDeviceMacId
„„* ;
,
„„; <

AlarmState
…… 
=
…… 
alarm
…… "
.
……" #
State
……# (
.
……( )
Name
……) -
,
……- .
AlarmComment
†† 
=
†† 
alarm
†† $
.
††$ %
Comment
††% ,
,
††, -
AcknowledgedFrom
‡‡  
=
‡‡! "
alarm
‡‡# (
.
‡‡( )
AcknowledgedFrom
‡‡) 9
}
ˆˆ 
;
ˆˆ 
}
‰‰ 	
public
‹‹ 
async
‹‹ 
Task
‹‹ 
<
‹‹  
GetLatestAlarmsDto
‹‹ ,
>
‹‹, -!
GetLatestFiveAlarms
‹‹. A
(
‹‹A B
)
‹‹B C
{
ŒŒ 	
var
 
ignoredStateId
 
=
  
await
! &
_context
' /
.
/ 0
AlarmStates
0 ;
.
; <
Where
< A
(
A B
state
B G
=>
H J
state
K P
.
P Q
Name
Q U
==
V X
$str
Y b
)
b c
.
c d
Select
d j
(
j k
state
k p
=>
q s
state
t y
.
y z
Id
z |
)
| }
.
} ~"
FirstOrDefaultAsync~ ‘
(‘ ’
)’ “
;“ ”
var
 
resolvedStateId
 
=
  !
await
" '
_context
( 0
.
0 1
AlarmStates
1 <
.
< =
Where
= B
(
B C
state
C H
=>
I K
state
L Q
.
Q R
Name
R V
==
W Y
$str
Z d
)
d e
.
e f
Select
f l
(
l m
state
m r
=>
s u
state
v {
.
{ |
Id
| ~
)
~ 
. €#
FirstOrDefaultAsync€ “
(“ ”
)” •
;• –
var
 
alarms
 
=
 
await
 
_context
 '
.
' (
Alarms
( .
.
. /
Where
/ 4
(
4 5
alarm
5 :
=>
; =
alarm
> C
.
C D
StateId
D K
!=
L N
ignoredStateId
O ]
&&
^ `
alarm
a f
.
f g
StateId
g n
!=
o q
resolvedStateIdr 
) ‚
.‚ ƒ
Includeƒ Š
(Š ‹
a‹ Œ
=> 
a ‘
.‘ ’
State’ —
)— ˜
.˜ ™!
OrderByDescending™ ª
(ª «
a« ¬
=>­ ¯
a° ±
.± ²
RaisedAt² º
)º »
.» ¼
Take¼ À
(À Á
$numÁ Â
)Â Ã
.Ã Ä
ToListAsyncÄ Ï
(Ï Ğ
)Ğ Ñ
;Ñ Ò
var
 
totalAlarms
 
=
 
await
 #
_context
$ ,
.
, -
Alarms
- 3
.
3 4

CountAsync
4 >
(
> ?
)
? @
;
@ A
var
’’ 
formattedAlarms
’’ 
=
’’  !
new
’’" %
List
’’& *
<
’’* +
GetAlarmDto
’’+ 6
>
’’6 7
(
’’7 8
)
’’8 9
;
’’9 :
alarms
““ 
.
““ 
ForEach
““ 
(
““ 
alarm
““  
=>
““! #
{
““$ %
formattedAlarms
”” 
.
””  
Add
””  #
(
””# $
new
””$ '
GetAlarmDto
””( 3
{
•• 
Id
–– 
=
–– 
alarm
–– 
.
–– 
Id
–– !
,
––! "
AcknowledgedAt
—— "
=
——# $
alarm
——% *
.
——* +
AcknowledgedAt
——+ 9
?
——9 :
.
——: ;
ToLocalTime
——; F
(
——F G
)
——G H
,
——H I
IsAcknowledged
˜˜ "
=
˜˜# $
alarm
˜˜% *
.
˜˜* +
IsAcknowledged
˜˜+ 9
,
˜˜9 :
Message
™™ 
=
™™ 
alarm
™™ #
.
™™# $
Message
™™$ +
,
™™+ ,
RaisedAt
šš 
=
šš 
alarm
šš $
.
šš$ %
RaisedAt
šš% -
.
šš- .
ToLocalTime
šš. 9
(
šš9 :
)
šš: ;
,
šš; <
Severity
›› 
=
›› 
alarm
›› $
.
››$ %
Severity
››% -
.
››- .
ToString
››. 6
(
››6 7
)
››7 8
,
››8 9
SourceDeviceMacId
œœ %
=
œœ& '
alarm
œœ( -
.
œœ- .
SourceDeviceMacId
œœ. ?
,
œœ? @

AlarmState
 
=
  
alarm
! &
.
& '
State
' ,
.
, -
Name
- 1
,
1 2
AlarmComment
  
=
! "
alarm
# (
.
( )
Comment
) 0
}
ŸŸ 
)
ŸŸ 
;
ŸŸ 
}
   
)
   
;
   
return
¢¢ 
new
¢¢  
GetLatestAlarmsDto
¢¢ )
{
££ 
TotalAlarms
¤¤ 
=
¤¤ 
totalAlarms
¤¤ )
,
¤¤) *
Alarms
¥¥ 
=
¥¥ 
formattedAlarms
¥¥ (
}
¦¦ 
;
¦¦ 
}
§§ 	
public
©© 
async
©© 
Task
©© 
<
©© (
GetLatestAlarmForDeviceDto
©© 4
>
©©4 5%
GetLatestAlarmForDevice
©©6 M
(
©©M N
string
©©N T
deviceMacId
©©U `
)
©©` a
{
ªª 	
var
«« 
resolvedStateId
«« 
=
««  !
await
««" '
_context
««( 0
.
««0 1
AlarmStates
««1 <
.
««< =
Where
««= B
(
««B C
state
««C H
=>
««I K
state
««L Q
.
««Q R
Name
««R V
==
««W Y
$str
««Z d
)
««d e
.
««e f
Select
««f l
(
««l m
state
««m r
=>
««s u
state
««v {
.
««{ |
Id
««| ~
)
««~ 
.«« €#
FirstOrDefaultAsync««€ “
(««“ ”
)««” •
;««• –
var
¬¬ 
ignoredStateId
¬¬ 
=
¬¬  
await
¬¬! &
_context
¬¬' /
.
¬¬/ 0
AlarmStates
¬¬0 ;
.
¬¬; <
Where
¬¬< A
(
¬¬A B
state
¬¬B G
=>
¬¬H J
state
¬¬K P
.
¬¬P Q
Name
¬¬Q U
==
¬¬V X
$str
¬¬Y b
)
¬¬b c
.
¬¬c d
Select
¬¬d j
(
¬¬j k
state
¬¬k p
=>
¬¬q s
state
¬¬t y
.
¬¬y z
Id
¬¬z |
)
¬¬| }
.
¬¬} ~"
FirstOrDefaultAsync¬¬~ ‘
(¬¬‘ ’
)¬¬’ “
;¬¬“ ”
var
­­ 
alarms
­­ 
=
­­ 
_context
­­ !
.
­­! "
Alarms
­­" (
.
­­( )
Where
­­) .
(
­­. /
a
­­/ 0
=>
­­1 3
(
­­4 5
a
­­5 6
.
­­6 7
SourceDeviceMacId
­­7 H
==
­­I K
deviceMacId
­­L W
&&
­­X Z
a
­­[ \
.
­­\ ]
StateId
­­] d
!=
­­e g
ignoredStateId
­­h v
&&
­­w y
a
­­z {
.
­­{ |
StateId­­| ƒ
!=­­„ †
resolvedStateId­­‡ –
)­­– —
)­­— ˜
?­­˜ ™
.­­™ š
Include­­š ¡
(­­¡ ¢
a­­¢ £
=>­­¤ ¦
a­­§ ¨
.­­¨ ©
State­­© ®
)­­® ¯
.­­¯ °!
OrderByDescending­­° Á
(­­Á Â
a­­Â Ã
=>­­Ä Æ
a­­Ç È
.­­È É
RaisedAt­­É Ñ
)­­Ñ Ò
.­­Ò Ó
AsQueryable­­Ó Ş
(­­Ş ß
)­­ß à
;­­à á
var
®® 
totalAlarms
®® 
=
®® 
await
®® #
alarms
®®$ *
.
®®* +

CountAsync
®®+ 5
(
®®5 6
)
®®6 7
;
®®7 8
var
¯¯ 
alarm
¯¯ 
=
¯¯ 
await
¯¯ 
alarms
¯¯ $
.
¯¯$ %
Where
¯¯% *
(
¯¯* +
alarm
¯¯+ 0
=>
¯¯1 3
alarm
¯¯4 9
.
¯¯9 :
StateId
¯¯: A
!=
¯¯B D
resolvedStateId
¯¯E T
)
¯¯T U
.
¯¯U V!
FirstOrDefaultAsync
¯¯V i
(
¯¯i j
)
¯¯j k
;
¯¯k l
if
°° 
(
°° 
alarm
°° 
==
°° 
null
°° 
)
°° 
throw
±± 
new
±± 
CustomException
±± )
(
±±) *
$num
±±* -
,
±±- .
$str
±±/ P
)
±±P Q
;
±±Q R
var
³³ 
formattedAlarm
³³ 
=
³³  
new
³³! $
GetAlarmDto
³³% 0
{
´´ 
Id
µµ 
=
µµ 
alarm
µµ 
.
µµ 
Id
µµ 
,
µµ 
AcknowledgedAt
¶¶ 
=
¶¶  
alarm
¶¶! &
.
¶¶& '
AcknowledgedAt
¶¶' 5
?
¶¶5 6
.
¶¶6 7
ToLocalTime
¶¶7 B
(
¶¶B C
)
¶¶C D
,
¶¶D E
IsAcknowledged
·· 
=
··  
alarm
··! &
.
··& '
IsAcknowledged
··' 5
,
··5 6
Message
¸¸ 
=
¸¸ 
alarm
¸¸ 
.
¸¸  
Message
¸¸  '
,
¸¸' (
RaisedAt
¹¹ 
=
¹¹ 
alarm
¹¹  
.
¹¹  !
RaisedAt
¹¹! )
.
¹¹) *
ToLocalTime
¹¹* 5
(
¹¹5 6
)
¹¹6 7
,
¹¹7 8
Severity
ºº 
=
ºº 
alarm
ºº  
.
ºº  !
Severity
ºº! )
.
ºº) *
ToString
ºº* 2
(
ºº2 3
)
ºº3 4
,
ºº4 5
SourceDeviceMacId
»» !
=
»»" #
alarm
»»$ )
.
»») *
SourceDeviceMacId
»»* ;
,
»»; <

AlarmState
¼¼ 
=
¼¼ 
alarm
¼¼ "
.
¼¼" #
State
¼¼# (
.
¼¼( )
Name
¼¼) -
}
½½ 
;
½½ 
return
¿¿ 
new
¿¿ (
GetLatestAlarmForDeviceDto
¿¿ 1
{
ÀÀ 
TotalAlarms
ÁÁ 
=
ÁÁ 
totalAlarms
ÁÁ )
,
ÁÁ) *
Alarm
ÂÂ 
=
ÂÂ 
formattedAlarm
ÂÂ &
}
ÃÃ 
;
ÃÃ 
}
ÄÄ 	
public
ÆÆ 
async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
IEnumerable
ÆÆ %
<
ÆÆ% &
GetAlarmStatesDto
ÆÆ& 7
>
ÆÆ7 8
>
ÆÆ8 9
GetAlarmStates
ÆÆ: H
(
ÆÆH I
)
ÆÆI J
{
ÇÇ 	
var
ÈÈ 
states
ÈÈ 
=
ÈÈ 
await
ÈÈ 
_context
ÈÈ '
.
ÈÈ' (
AlarmStates
ÈÈ( 3
.
ÈÈ3 4
Select
ÈÈ4 :
(
ÈÈ: ;
state
ÈÈ; @
=>
ÈÈA C
new
ÈÈD G
GetAlarmStatesDto
ÈÈH Y
{
ÉÉ 
Id
ÊÊ 
=
ÊÊ 
state
ÊÊ 
.
ÊÊ 
Id
ÊÊ 
,
ÊÊ 
Name
ËË 
=
ËË 
state
ËË 
.
ËË 
Name
ËË !
,
ËË! "
}
ÌÌ 
)
ÌÌ 
.
ÌÌ 
ToListAsync
ÌÌ 
(
ÌÌ 
)
ÌÌ 
;
ÌÌ 
return
ÎÎ 
states
ÎÎ 
;
ÎÎ 
}
ÏÏ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
GetAlarmDto
ÑÑ %
>
ÑÑ% &
ResolveAlarm
ÑÑ' 3
(
ÑÑ3 4
Guid
ÑÑ4 8
alarmId
ÑÑ9 @
,
ÑÑ@ A
string
ÑÑB H
comment
ÑÑI P
)
ÑÑP Q
{
ÒÒ 	
var
ÓÓ 
alarm
ÓÓ 
=
ÓÓ 
await
ÓÓ 
_context
ÓÓ &
.
ÓÓ& '
Alarms
ÓÓ' -
.
ÓÓ- ."
SingleOrDefaultAsync
ÓÓ. B
(
ÓÓB C
alarm
ÓÓC H
=>
ÓÓI K
alarm
ÓÓL Q
.
ÓÓQ R
Id
ÓÓR T
==
ÓÓU W
alarmId
ÓÓX _
)
ÓÓ_ `
;
ÓÓ` a
if
ÔÔ 
(
ÔÔ 
alarm
ÔÔ 
is
ÔÔ 
null
ÔÔ 
)
ÔÔ 
throw
ÕÕ 
new
ÕÕ 
CustomException
ÕÕ )
(
ÕÕ) *
$num
ÕÕ* -
,
ÕÕ- .
$str
ÕÕ/ @
)
ÕÕ@ A
;
ÕÕA B
if
×× 
(
×× 
alarm
×× 
.
×× 
IsAcknowledged
×× #
is
××$ &
false
××' ,
)
××, -
{
ØØ 
alarm
ÙÙ 
.
ÙÙ 
IsAcknowledged
ÙÙ $
=
ÙÙ% &
true
ÙÙ' +
;
ÙÙ+ ,
alarm
ÚÚ 
.
ÚÚ 
AcknowledgedAt
ÚÚ $
=
ÚÚ% &
DateTime
ÚÚ' /
.
ÚÚ/ 0
UtcNow
ÚÚ0 6
;
ÚÚ6 7
alarm
ÛÛ 
.
ÛÛ 
AcknowledgedFrom
ÛÛ &
=
ÛÛ' (
$str
ÛÛ) I
;
ÛÛI J
}
ÜÜ 
else
İİ 
{
ŞŞ 
alarm
ßß 
.
ßß 
AcknowledgedFrom
ßß &
=
ßß' (
$str
ßß) F
;
ßßF G
}
àà 
var
ââ 
resolvedState
ââ 
=
ââ 
await
ââ  %
_context
ââ& .
.
ââ. /
AlarmStates
ââ/ :
.
ââ: ;"
SingleOrDefaultAsync
ââ; O
(
ââO P
alarm
ââP U
=>
ââV X
alarm
ââY ^
.
ââ^ _
Name
ââ_ c
==
ââd f
$str
ââg q
)
ââq r
;
ââr s
alarm
ãã 
.
ãã 
StateId
ãã 
=
ãã 
resolvedState
ãã )
?
ãã) *
.
ãã* +
Id
ãã+ -
??
ãã. 0
$num
ãã1 2
;
ãã2 3
alarm
ää 
.
ää 
Comment
ää 
=
ää 
(
ää 
comment
ää $
!=
ää% '
$str
ää( 0
&&
ää1 3
comment
ää4 ;
.
ää; <
Length
ää< B
>
ääC D
$num
ääE F
)
ääF G
?
ääH I
comment
ääJ Q
:
ääR S
$str
ääT p
;
ääp q
alarm
åå 
.
åå 

ResolvedAt
åå 
=
åå 
DateTime
åå '
.
åå' (
UtcNow
åå( .
;
åå. /
_context
èè 
.
èè 
Entry
èè 
(
èè 
alarm
èè  
)
èè  !
.
èè! "
State
èè" '
=
èè( )
EntityState
èè* 5
.
èè5 6
Modified
èè6 >
;
èè> ?
try
êê 
{
ëë 
await
ìì 
_context
ìì 
.
ìì 
SaveChangesAsync
ìì /
(
ìì/ 0
)
ìì0 1
;
ìì1 2
}
íí 
catch
îî 
(
îî *
DbUpdateConcurrencyException
îî /
ex
îî0 2
)
îî2 3
{
ïï 
throw
ğğ 
new
ğğ 
CustomException
ğğ )
(
ğğ) *
$num
ğğ* -
,
ğğ- .
ex
ğğ/ 1
.
ğğ1 2
Message
ğğ2 9
)
ğğ9 :
;
ğğ: ;
}
ññ 
var
óó 
mainPageUpdates
óó 
=
óó  !
await
óó" '!
GetLatestFiveAlarms
óó( ;
(
óó; <
)
óó< =
;
óó= >
var
ôô 
serializedData
ôô 
=
ôô  
JsonSerializer
ôô! /
.
ôô/ 0
	Serialize
ôô0 9
(
ôô9 :
mainPageUpdates
ôô: I
,
ôôI J
new
ôôK N#
JsonSerializerOptions
ôôO d
{
õõ 
Encoder
öö 
=
öö 
JavaScriptEncoder
öö +
.
öö+ ,'
UnsafeRelaxedJsonEscaping
öö, E
,
ööE F
WriteIndented
÷÷ 
=
÷÷ 
true
÷÷  $
,
÷÷$ %"
PropertyNamingPolicy
øø $
=
øø% &
JsonNamingPolicy
øø' 7
.
øø7 8
	CamelCase
øø8 A
,
øøA B
}
ùù 
)
ùù 
;
ùù 
await
úú 
_alertService
úú 
.
úú  
MainPageUpdates
úú  /
(
úú/ 0
serializedData
úú0 >
)
úú> ?
;
úú? @
try
üü 
{
ıı 
var
şş  
propertyPanelAlarm
şş &
=
şş' (
await
şş) .%
GetLatestAlarmForDevice
şş/ F
(
şşF G
alarm
şşG L
.
şşL M
SourceDeviceMacId
şşM ^
)
şş^ _
;
şş_ `
await
ÿÿ 
_alertService
ÿÿ #
.
ÿÿ# $"
PropertyPanelUpdates
ÿÿ$ 8
(
ÿÿ8 9
JsonSerializer
ÿÿ9 G
.
ÿÿG H
	Serialize
ÿÿH Q
(
ÿÿQ R 
propertyPanelAlarm
ÿÿR d
,
ÿÿd e
new
ÿÿf i#
JsonSerializerOptions
ÿÿj 
{
€€ 
Encoder
 
=
 
JavaScriptEncoder
 /
.
/ 0'
UnsafeRelaxedJsonEscaping
0 I
,
I J"
PropertyNamingPolicy
‚‚ (
=
‚‚) *
JsonNamingPolicy
‚‚+ ;
.
‚‚; <
	CamelCase
‚‚< E
,
‚‚E F
WriteIndented
ƒƒ !
=
ƒƒ" #
true
ƒƒ$ (
}
„„ 
)
„„ 
,
„„ 
alarm
„„ 
.
„„ 
SourceDeviceMacId
„„ +
)
„„+ ,
;
„„, -
}
…… 
catch
†† 
(
†† 
CustomException
†† "
ex
††# %
)
††% &
{
‡‡ 
await
ˆˆ 
_alertService
ˆˆ #
.
ˆˆ# $"
PropertyPanelUpdates
ˆˆ$ 8
(
ˆˆ8 9
$str
ˆˆ9 ;
,
ˆˆ; <
alarm
ˆˆ= B
.
ˆˆB C
SourceDeviceMacId
ˆˆC T
)
ˆˆT U
;
ˆˆU V
}
‰‰ 
return
‹‹ 
new
‹‹ 
GetAlarmDto
‹‹ "
{
ŒŒ 
Id
 
=
 
alarm
 
.
 
Id
 
,
 
AcknowledgedAt
 
=
  
alarm
! &
.
& '
AcknowledgedAt
' 5
?
5 6
.
6 7
ToLocalTime
7 B
(
B C
)
C D
,
D E
IsAcknowledged
 
=
  
alarm
! &
.
& '
IsAcknowledged
' 5
,
5 6
Message
 
=
 
alarm
 
.
  
Message
  '
,
' (
RaisedAt
‘‘ 
=
‘‘ 
alarm
‘‘  
.
‘‘  !
RaisedAt
‘‘! )
.
‘‘) *
ToLocalTime
‘‘* 5
(
‘‘5 6
)
‘‘6 7
,
‘‘7 8
Severity
’’ 
=
’’ 
alarm
’’  
.
’’  !
Severity
’’! )
.
’’) *
ToString
’’* 2
(
’’2 3
)
’’3 4
,
’’4 5
SourceDeviceMacId
““ !
=
““" #
alarm
““$ )
.
““) *
SourceDeviceMacId
““* ;
,
““; <

AlarmState
”” 
=
”” 
alarm
”” "
.
””" #
State
””# (
.
””( )
Name
””) -
,
””- .
AlarmComment
•• 
=
•• 
alarm
•• $
.
••$ %
Comment
••% ,
,
••, -
AcknowledgedFrom
––  
=
––! "
alarm
––# (
.
––( )
AcknowledgedFrom
––) 9
}
—— 
;
—— 
}
˜˜ 	
public
šš 
async
šš 
Task
šš 
<
šš 
string
šš  
>
šš  ! 
AddAlarmRulesAsync
šš" 4
(
šš4 5
string
šš5 ;
deviceMacId
šš< G
,
ššG H
List
ššI M
<
ššM N
AlarmRuleDto
ššN Z
>
ššZ [
rules
šš\ a
)
šša b
{
›› 	
var
œœ 
alarmsToRemove
œœ 
=
œœ  
await
œœ! &
_context
œœ' /
.
œœ/ 0

AlarmRules
œœ0 :
.
œœ: ;
Where
œœ; @
(
œœ@ A
alarm
œœA F
=>
œœG I
alarm
œœJ O
.
œœO P
DeviceMacId
œœP [
==
œœ\ ^
deviceMacId
œœ_ j
)
œœj k
.
œœk l
ToListAsync
œœl w
(
œœw x
)
œœx y
;
œœy z
if
 
(
 
alarmsToRemove
 
.
 
Count
 #
>
$ %
$num
& '
)
' (
{
ŸŸ 
_context
   
.
   

AlarmRules
   #
.
  # $
RemoveRange
  $ /
(
  / 0
alarmsToRemove
  0 >
)
  > ?
;
  ? @
await
¡¡ 
_context
¡¡ 
.
¡¡ 
SaveChangesAsync
¡¡ /
(
¡¡/ 0
)
¡¡0 1
;
¡¡1 2
}
¢¢ 
var
¤¤ 
ruleEntities
¤¤ 
=
¤¤ 
rules
¤¤ $
.
¤¤$ %
Select
¤¤% +
(
¤¤+ ,
rule
¤¤, 0
=>
¤¤1 3
new
¤¤4 7
	AlarmRule
¤¤8 A
{
¥¥ 
DeviceMacId
¦¦ 
=
¦¦ 
deviceMacId
¦¦ )
,
¦¦) *
	FieldPath
§§ 
=
§§ 
rule
§§  
.
§§  !
	FieldPath
§§! *
,
§§* +
Operator
¨¨ 
=
¨¨ 
rule
¨¨ 
.
¨¨  
Operator
¨¨  (
,
¨¨( )
ThresholdValue
©© 
=
©©  
rule
©©! %
.
©©% &
ThresholdValue
©©& 4
,
©©4 5
Severity
ªª 
=
ªª 
Enum
ªª 
.
ªª  
TryParse
ªª  (
<
ªª( )
AlarmSeverity
ªª) 6
>
ªª6 7
(
ªª7 8
rule
ªª8 <
.
ªª< =
Severity
ªª= E
,
ªªE F
true
ªªG K
,
ªªK L
out
ªªM P
var
ªªQ T
severity
ªªU ]
)
ªª] ^
?
«« 
severity
«« "
:
¬¬ 
AlarmSeverity
¬¬ '
.
¬¬' (
Warning
¬¬( /
,
¬¬/ 0
MessageTemplate
­­ 
=
­­  !
rule
­­" &
.
­­& '
MessageTemplate
­­' 6
}
®® 
)
®® 
.
®® 
ToList
®® 
(
®® 
)
®® 
;
®® 
await
°° 
_context
°° 
.
°° 

AlarmRules
°° %
.
°°% &
AddRangeAsync
°°& 3
(
°°3 4
ruleEntities
°°4 @
)
°°@ A
;
°°A B
await
±± 
_context
±± 
.
±± 
SaveChangesAsync
±± +
(
±±+ ,
)
±±, -
;
±±- .
return
³³ 
$str
³³ 3
;
³³3 4
}
´´ 	
}
µµ 
}¶¶ µ~
‘C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\AlarmService\Infrastructure\Services\AlarmEvaluationService.cs
	namespace 	
Infrastructure
 
. 
Services !
{ 
public 

class "
AlarmEvaluationService '
:( )#
IAlarmEvaluationService* A
{ 
private 
readonly 
AlarmDbContext '

_dbContext( 2
;2 3
private 
readonly 
IAlarmService &
_alarmService' 4
;4 5
private 
readonly 
AlertService %
_alertService& 3
;3 4
public "
AlarmEvaluationService %
(% &
AlarmDbContext& 4
	dbContext5 >
,> ?
IAlarmService@ M
alarmServiceN Z
,Z [
AlertService\ h
alertServicei u
)u v
{ 	

_dbContext 
= 
	dbContext "
;" #
_alarmService 
= 
alarmService (
;( )
_alertService 
= 
alertService (
;( )
} 	
public 
async 
Task 
< 
List 
< 
Alarm $
>$ %
>% &!
EvaluateTopLevelAsync' <
(< =!
TopLevelDeviceDataDto= R
currentS Z
,Z [!
TopLevelDeviceDataDto\ q
previousr z
)z {
{ 	
var 
currentFlat 
= 
new !

Dictionary" ,
<, -
string- 3
,3 4
string5 ;
>; <
{ 
[   
$str   
]   
=   
current   $
.  $ %
Status  % +
??  , .
$str  / 8
,  8 9
[!! 
$str!! 
]!!  
=!!! "
current!!# *
.!!* +
Connectivity!!+ 7
??!!8 :
$str!!; D
}"" 
;"" 
var$$ 
previousFlat$$ 
=$$ 
new$$ "

Dictionary$$# -
<$$- .
string$$. 4
,$$4 5
string$$6 <
>$$< =
{%% 
[&& 
$str&& 
]&& 
=&& 
previous&& %
.&&% &
Status&&& ,
??&&- /
$str&&0 9
,&&9 :
['' 
$str'' 
]''  
=''! "
previous''# +
.''+ ,
Connectivity'', 8
??''9 ;
$str''< E
}(( 
;(( 
return** 
await** 
EvaluateRulesAsync** +
(**+ ,
current**, 3
.**3 4
DeviceMacId**4 ?
,**? @
currentFlat**A L
,**L M
previousFlat**N Z
)**Z [
;**[ \
}++ 	
public-- 
async-- 
Task-- 
<-- 
List-- 
<-- 
Alarm-- $
>--$ %
>--% & 
EvaluateDynamicAsync--' ;
(--; < 
DynamicDeviceDataDto--< P
current--Q X
,--X Y 
DynamicDeviceDataDto--Z n
previous--o w
)--w x
{.. 	
var// 
currentFlat// 
=// 
JsonFlattener// +
.//+ ,
FlattenJson//, 7
(//7 8
current//8 ?
.//? @
DynamicProperties//@ Q
)//Q R
;//R S
var00 
previousFlat00 
=00 
JsonFlattener00 ,
.00, -
FlattenJson00- 8
(008 9
previous009 A
.00A B
DynamicProperties00B S
)00S T
;00T U
return22 
await22 
EvaluateRulesAsync22 +
(22+ ,
current22, 3
.223 4
DeviceMacId224 ?
,22? @
currentFlat22A L
,22L M
previousFlat22N Z
)22Z [
;22[ \
}33 	
private55 
async55 
Task55 
<55 
List55 
<55  
Alarm55  %
>55% &
>55& '
EvaluateRulesAsync55( :
(55: ;
string55; A
deviceMacId55B M
,55M N

Dictionary55O Y
<55Y Z
string55Z `
,55` a
string55b h
>55h i
currentFlat55j u
,55u v

Dictionary	55w 
<
55 ‚
string
55‚ ˆ
,
55ˆ ‰
string
55Š 
>
55 ‘
previousFlat
55’ 
)
55 Ÿ
{66 	
var77 
rules77 
=77 
await77 

_dbContext77 (
.77( )

AlarmRules77) 3
.88 
Where88 
(88 
r88 
=>88 
r88 
.88 
DeviceMacId88 )
==88* ,
deviceMacId88- 8
)888 9
.99 
ToListAsync99 
(99 
)99 
;99 
var;; 
triggeredAlarms;; 
=;;  !
new;;" %
List;;& *
<;;* +
Alarm;;+ 0
>;;0 1
(;;1 2
);;2 3
;;;3 4
foreach== 
(== 
var== 
rule== 
in==  
rules==! &
)==& '
{>> 
if?? 
(?? 
!?? 
currentFlat??  
.??  !
TryGetValue??! ,
(??, -
rule??- 1
.??1 2
	FieldPath??2 ;
,??; <
out??= @
var??A D
currentValue??E Q
)??Q R
)??R S
continue@@ 
;@@ 
ifBB 
(BB 
!BB 
IsThresholdBreachedBB (
(BB( )
currentValueBB) 5
,BB5 6
ruleBB7 ;
.BB; <
OperatorBB< D
,BBD E
ruleBBF J
.BBJ K
ThresholdValueBBK Y
)BBY Z
)BBZ [
continueCC 
;CC 
ifEE 
(EE 
previousFlatEE  
.EE  !
TryGetValueEE! ,
(EE, -
ruleEE- 1
.EE1 2
	FieldPathEE2 ;
,EE; <
outEE= @
varEEA D
previousValueEEE R
)EER S
&&EET V
previousValueFF !
==FF" $
currentValueFF% 1
)FF1 2
{GG 
continueHH 
;HH 
}II 
varKK 
alarmKK 
=KK 
newKK 
AlarmKK  %
{LL 
SourceDeviceMacIdMM %
=MM& '
deviceMacIdMM( 3
,MM3 4
MessageNN 
=NN 
ruleNN "
.NN" #
MessageTemplateNN# 2
.NN2 3
ReplaceNN3 :
(NN: ;
$strNN; D
,NND E
currentValueNNF R
)NNR S
,NNS T
SeverityOO 
=OO 
ruleOO #
.OO# $
SeverityOO$ ,
}PP 
;PP 
triggeredAlarmsRR 
.RR  
AddRR  #
(RR# $
alarmRR$ )
)RR) *
;RR* +
}SS 
ifUU 
(UU 
triggeredAlarmsUU 
.UU  
AnyUU  #
(UU# $
)UU$ %
)UU% &
{VV 

_dbContextWW 
.WW 
AlarmsWW !
.WW! "
AddRangeWW" *
(WW* +
triggeredAlarmsWW+ :
)WW: ;
;WW; <
awaitXX 

_dbContextXX  
.XX  !
SaveChangesAsyncXX! 1
(XX1 2
)XX2 3
;XX3 4
varZZ 
mainPageUpdatesZZ #
=ZZ$ %
awaitZZ& +
_alarmServiceZZ, 9
.ZZ9 :
GetLatestFiveAlarmsZZ: M
(ZZM N
)ZZN O
;ZZO P
var[[ 
serializedData[[ "
=[[# $
JsonSerializer[[% 3
.[[3 4
	Serialize[[4 =
([[= >
mainPageUpdates[[> M
,[[M N
new[[O R!
JsonSerializerOptions[[S h
{\\ 
Encoder]] 
=]] 
JavaScriptEncoder]] /
.]]/ 0%
UnsafeRelaxedJsonEscaping]]0 I
,]]I J
WriteIndented^^ !
=^^" #
true^^$ (
,^^( ) 
PropertyNamingPolicy__ (
=__) *
JsonNamingPolicy__+ ;
.__; <
	CamelCase__< E
,__E F
}`` 
)`` 
;`` 
awaitaa 
_alertServiceaa #
.aa# $
MainPageUpdatesaa$ 3
(aa3 4
serializedDataaa4 B
)aaB C
;aaC D
varcc 
alarmPanelUpdatescc %
=cc& '
awaitcc( -
_alarmServicecc. ;
.cc; <
	GetAlarmscc< E
(ccE F
newccF I
AlarmFilterccJ U
(ccU V
)ccV W
)ccW X
;ccX Y
awaitee 
_alertServiceee #
.ee# $
AlarmPanelUpdatesee$ 5
(ee5 6
JsonSerializeree6 D
.eeD E
	SerializeeeE N
(eeN O
alarmPanelUpdateseeO `
,ee` a
neweeb e!
JsonSerializerOptionseef {
{ff 
Encodergg 
=gg 
JavaScriptEncodergg /
.gg/ 0%
UnsafeRelaxedJsonEscapinggg0 I
,ggI J 
PropertyNamingPolicyhh (
=hh) *
JsonNamingPolicyhh+ ;
.hh; <
	CamelCasehh< E
,hhE F
WriteIndentedii !
=ii" #
trueii$ (
}jj 
)jj 
)jj 
;jj 
varll 
propertyPanelAlarmll &
=ll' (
awaitll) .
_alarmServicell/ <
.ll< =#
GetLatestAlarmForDevicell= T
(llT U
deviceMacIdllU `
)ll` a
;lla b
awaitnn 
_alertServicenn #
.nn# $ 
PropertyPanelUpdatesnn$ 8
(nn8 9
JsonSerializernn9 G
.nnG H
	SerializennH Q
(nnQ R
propertyPanelAlarmnnR d
,nnd e
newnnf i!
JsonSerializerOptionsnnj 
{oo 
Encoderpp 
=pp 
JavaScriptEncoderpp /
.pp/ 0%
UnsafeRelaxedJsonEscapingpp0 I
,ppI J 
PropertyNamingPolicyqq (
=qq) *
JsonNamingPolicyqq+ ;
.qq; <
	CamelCaseqq< E
,qqE F
WriteIndentedrr !
=rr" #
truerr$ (
}ss 
)ss 
,ss 
deviceMacIdss 
)ss  
;ss  !
}tt 
returnvv 
triggeredAlarmsvv "
;vv" #
}ww 	
privateyy 
boolyy 
IsThresholdBreachedyy (
(yy( )
stringyy) /
currentyy0 7
,yy7 8
stringyy9 ?
opyy@ B
,yyB C
stringyyD J
	thresholdyyK T
)yyT U
{zz 	
string{{ 
normalizedOp{{ 
={{  !
op{{" $
.{{$ %
Trim{{% )
({{) *
){{* +
.{{+ ,
ToLowerInvariant{{, <
({{< =
){{= >
;{{> ?
string}} 
Clean}} 
(}} 
string}} 
val}}  #
)}}# $
=>}}% '
val}}( +
.}}+ ,
Trim}}, 0
(}}0 1
)}}1 2
.~~+ ,
TrimEnd~~, 3
(~~3 4
$char~~4 7
,~~7 8
$char~~9 <
,~~< =
$char~~> A
,~~A B
$char~~C F
)~~F G
.+ ,
Replace, 3
(3 4
$str4 8
,8 9
$str: <
,< =
StringComparison> N
.N O
OrdinalIgnoreCaseO `
)` a
.
€€+ ,
Replace
€€, 3
(
€€3 4
$str
€€4 :
,
€€: ;
$str
€€< >
,
€€> ?
StringComparison
€€@ P
.
€€P Q
OrdinalIgnoreCase
€€Q b
)
€€b c
.
+ ,
Replace
, 3
(
3 4
$str
4 :
,
: ;
$str
< >
,
> ?
StringComparison
@ P
.
P Q
OrdinalIgnoreCase
Q b
)
b c
.
‚‚+ ,
Replace
‚‚, 3
(
‚‚3 4
$str
‚‚4 8
,
‚‚8 9
$str
‚‚: <
,
‚‚< =
StringComparison
‚‚> N
.
‚‚N O
OrdinalIgnoreCase
‚‚O `
)
‚‚` a
.
ƒƒ+ ,
Replace
ƒƒ, 3
(
ƒƒ3 4
$str
ƒƒ4 8
,
ƒƒ8 9
$str
ƒƒ: <
,
ƒƒ< =
StringComparison
ƒƒ> N
.
ƒƒN O
OrdinalIgnoreCase
ƒƒO `
)
ƒƒ` a
.
„„+ ,
Replace
„„, 3
(
„„3 4
$str
„„4 8
,
„„8 9
$str
„„: <
,
„„< =
StringComparison
„„> N
.
„„N O
OrdinalIgnoreCase
„„O `
)
„„` a
;
„„a b
string
†† 
cleanedCurrent
†† !
=
††" #
Clean
††$ )
(
††) *
current
††* 1
)
††1 2
;
††2 3
string
‡‡ 
cleanedThreshold
‡‡ #
=
‡‡$ %
Clean
‡‡& +
(
‡‡+ ,
	threshold
‡‡, 5
)
‡‡5 6
;
‡‡6 7
if
‰‰ 
(
‰‰ 
double
‰‰ 
.
‰‰ 
TryParse
‰‰ 
(
‰‰  
cleanedCurrent
‰‰  .
,
‰‰. /
out
‰‰0 3
var
‰‰4 7
currNum
‰‰8 ?
)
‰‰? @
&&
‰‰A C
double
ŠŠ 
.
ŠŠ 
TryParse
ŠŠ 
(
ŠŠ  
cleanedThreshold
ŠŠ  0
,
ŠŠ0 1
out
ŠŠ2 5
var
ŠŠ6 9
	threshNum
ŠŠ: C
)
ŠŠC D
)
ŠŠD E
{
‹‹ 
return
ŒŒ 
normalizedOp
ŒŒ #
switch
ŒŒ$ *
{
 
$str
 !
=>
" $
currNum
% ,
>
- .
	threshNum
/ 8
,
8 9
$str
 
=>
 !
currNum
" )
<
* +
	threshNum
, 5
,
5 6
$str
 
=>
 
currNum
  '
==
( *
	threshNum
+ 4
,
4 5
$str
‘‘ 
=>
‘‘  "
currNum
‘‘# *
!=
‘‘+ -
	threshNum
‘‘. 7
,
‘‘7 8
$str
’’ (
=>
’’) +
currNum
’’, 3
>=
’’4 6
	threshNum
’’7 @
,
’’@ A
$str
““ %
=>
““& (
currNum
““) 0
<=
““1 3
	threshNum
““4 =
,
““= >
_
”” 
=>
”” 
false
”” 
}
•• 
;
•• 
}
–– 
if
˜˜ 
(
˜˜ 
normalizedOp
˜˜ 
==
˜˜ 
$str
˜˜  ,
)
˜˜, -
{
™™ 
if
šš 
(
šš 
DateTime
šš 
.
šš 
TryParse
šš %
(
šš% &
current
šš& -
,
šš- .
out
šš/ 2
var
šš3 6
dateVal
šš7 >
)
šš> ?
)
šš? @
return
›› 
dateVal
›› "
<
››# $
DateTime
››% -
.
››- .
UtcNow
››. 4
;
››4 5
return
 
false
 
;
 
}
 
return
   
normalizedOp
   
switch
    &
{
¡¡ 
$str
¢¢ 
=>
¢¢ 
string
¢¢ "
.
¢¢" #
Equals
¢¢# )
(
¢¢) *
current
¢¢* 1
,
¢¢1 2
	threshold
¢¢3 <
,
¢¢< =
StringComparison
¢¢> N
.
¢¢N O
OrdinalIgnoreCase
¢¢O `
)
¢¢` a
,
¢¢a b
$str
££ 
=>
££ 
!
££  
string
££  &
.
££& '
Equals
££' -
(
££- .
current
££. 5
,
££5 6
	threshold
££7 @
,
££@ A
StringComparison
££B R
.
££R S
OrdinalIgnoreCase
££S d
)
££d e
,
££e f
_
¤¤ 
=>
¤¤ 
false
¤¤ 
}
¥¥ 
;
¥¥ 
}
¦¦ 	
}
§§ 
}¨¨ œ
‡C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\AlarmService\Infrastructure\RealTime\AlertService.cs
	namespace		 	
Infrastructure		
 
.		 
RealTime		 !
{

 
public 

class 
AlertService 
{ 
private 
readonly 

HttpClient #
_httpClient$ /
;/ 0
public 
AlertService 
( 

HttpClient &

httpClient' 1
)1 2
{ 	
_httpClient 
= 

httpClient $
;$ %
} 	
public 
async 
Task 
MainPageUpdates )
() *
string* 0
json1 5
)5 6
{ 	
var 
content 
= 
new 
StringContent +
(+ ,
json, 0
,0 1
Encoding2 :
.: ;
UTF8; ?
,? @
$strA S
)S T
;T U
await 
_httpClient 
. 
	PostAsync '
(' (
$str( Z
,Z [
content\ c
)c d
;d e
} 	
public 
async 
Task 
AlarmPanelUpdates +
(+ ,
string, 2
json3 7
)7 8
{ 	
var 
content 
= 
new 
StringContent +
(+ ,
json, 0
,0 1
Encoding2 :
.: ;
UTF8; ?
,? @
$strA S
)S T
;T U
await 
_httpClient 
. 
	PostAsync '
(' (
$str( e
,e f
contentg n
)n o
;o p
} 	
public   
async   
Task    
PropertyPanelUpdates   .
(  . /
string  / 5
json  6 :
,  : ;
string  < B
deviceId  C K
)  K L
{!! 	
var"" 
content"" 
="" 
new"" 
StringContent"" +
(""+ ,
json"", 0
,""0 1
Encoding""2 :
."": ;
UTF8""; ?
,""? @
$str""A S
)""S T
;""T U
await## 
_httpClient## 
.## 
	PostAsync## '
(##' (
$"##( *
$str##* i
{##i j
deviceId##j r
}##r s
"##s t
,##t u
content##v }
)##} ~
;##~ 
}$$ 	
}%% 
}&& Ù0
ŒC:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\AlarmService\Infrastructure\Persistence\AlarmDbContext.cs
	namespace 	
Infrastructure
 
. 
Persistence $
{ 
public 

class 
AlarmDbContext 
:  !
	DbContext" +
{ 
public 
AlarmDbContext 
( 
DbContextOptions .
<. /
AlarmDbContext/ =
>= >
options? F
)F G
:		 
base		 
(		 
options		 
)		 
{

 	
} 	
public 
DbSet 
< 
Alarm 
> 
Alarms "
=># %
Set& )
<) *
Alarm* /
>/ 0
(0 1
)1 2
;2 3
public 
DbSet 
< 
	AlarmRule 
> 

AlarmRules  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DbSet 
< 

AlarmState 
>  
AlarmStates! ,
=>- /
Set0 3
<3 4

AlarmState4 >
>> ?
(? @
)@ A
;A B
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
Alarm  %
>% &
(& '
entity' -
=>. 0
{ 
entity 
. 
HasKey 
( 
e 
=>  "
e# $
.$ %
Id% '
)' (
;( )
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
SourceDeviceMacId' 8
)8 9
.9 :

IsRequired: D
(D E
)E F
;F G
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Message' .
). /
./ 0

IsRequired0 :
(: ;
); <
;< =
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '
Severity' /
)/ 0
. 
HasConversion $
<$ %
string% +
>+ ,
(, -
)- .
;. /
entity 
. 
Property 
(  
e  !
=>" $
e% &
.& '

ResolvedAt' 1
)1 2
. 

IsRequired !
(! "
false" '
)' (
;( )
entity 
. 
HasOne 
( 
e 
=>  "
e# $
.$ %
State% *
)* +
. 
WithMany 
(  
s  !
=>" $
s% &
.& '
Alarms' -
)- .
.   
HasForeignKey   $
(  $ %
e  % &
=>  ' )
e  * +
.  + ,
StateId  , 3
)  3 4
.!! 
OnDelete!! 
(!!  
DeleteBehavior!!  .
.!!. /
Restrict!!/ 7
)!!7 8
;!!8 9
entity## 
.## 
Property## 
(##  
e##  !
=>##" $
e##% &
.##& '
StateId##' .
)##. /
.##/ 0

IsRequired##0 :
(##: ;
)##; <
;##< =
}$$ 
)$$ 
;$$ 
modelBuilder&& 
.&& 
Entity&& 
<&&  
	AlarmRule&&  )
>&&) *
(&&* +
entity&&+ 1
=>&&2 4
{'' 
entity(( 
.(( 
HasKey(( 
((( 
e(( 
=>((  "
e((# $
.(($ %
Id((% '
)((' (
;((( )
entity** 
.** 
Property** 
(**  
e**  !
=>**" $
e**% &
.**& '
DeviceMacId**' 2
)**2 3
.**3 4

IsRequired**4 >
(**> ?
)**? @
;**@ A
entity++ 
.++ 
Property++ 
(++  
e++  !
=>++" $
e++% &
.++& '
	FieldPath++' 0
)++0 1
.++1 2

IsRequired++2 <
(++< =
)++= >
;++> ?
entity,, 
.,, 
Property,, 
(,,  
e,,  !
=>,," $
e,,% &
.,,& '
Operator,,' /
),,/ 0
.,,0 1

IsRequired,,1 ;
(,,; <
),,< =
;,,= >
entity-- 
.-- 
Property-- 
(--  
e--  !
=>--" $
e--% &
.--& '
ThresholdValue--' 5
)--5 6
.--6 7

IsRequired--7 A
(--A B
)--B C
;--C D
entity.. 
... 
Property.. 
(..  
e..  !
=>.." $
e..% &
...& '
MessageTemplate..' 6
)..6 7
...7 8

IsRequired..8 B
(..B C
)..C D
;..D E
entity00 
.00 
Property00 
(00  
e00  !
=>00" $
e00% &
.00& '
Severity00' /
)00/ 0
.11 
HasConversion11 $
<11$ %
string11% +
>11+ ,
(11, -
)11- .
;11. /
entity33 
.33 
Property33 
(33  
e33  !
=>33" $
e33% &
.33& '
	CreatedAt33' 0
)330 1
.331 2
HasDefaultValueSql332 D
(33D E
$str33E S
)33S T
;33T U
}44 
)44 
;44 
}55 	
}66 
}77 T
™C:\Users\Premal Kadam\Documents\Device Monitoring Project\DeviceMonitoring\Backend\AlarmService\Infrastructure\Migrations\20250819044630_InitialSQLite.cs
	namespace 	
Infrastructure
 
. 

Migrations #
{ 
public		 

partial		 
class		 
InitialSQLite		 &
:		' (
	Migration		) 2
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
DeviceMacId 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
	FieldPath 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
falseM R
)R S
,S T
Operator 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
ThresholdValue "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
type: >
:> ?
$str@ F
,F G
nullableH P
:P Q
falseR W
)W X
,X Y
Severity 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
MessageTemplate #
=$ %
table& +
.+ ,
Column, 2
<2 3
string3 9
>9 :
(: ;
type; ?
:? @
$strA G
,G H
nullableI Q
:Q R
falseS X
)X Y
,Y Z
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
,T U
defaultValueSqlV e
:e f
$strg u
)u v
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 4
,4 5
x6 7
=>8 :
x; <
.< =
Id= ?
)? @
;@ A
} 
) 
; 
migrationBuilder   
.   
CreateTable   (
(  ( )
name!! 
:!! 
$str!! #
,!!# $
columns"" 
:"" 
table"" 
=>"" !
new""" %
{## 
Id$$ 
=$$ 
table$$ 
.$$ 
Column$$ %
<$$% &
int$$& )
>$$) *
($$* +
type$$+ /
:$$/ 0
$str$$1 :
,$$: ;
nullable$$< D
:$$D E
false$$F K
)$$K L
.%% 

Annotation%% #
(%%# $
$str%%$ :
,%%: ;
true%%< @
)%%@ A
,%%A B
Name&& 
=&& 
table&&  
.&&  !
Column&&! '
<&&' (
string&&( .
>&&. /
(&&/ 0
type&&0 4
:&&4 5
$str&&6 <
,&&< =
nullable&&> F
:&&F G
false&&H M
)&&M N
}'' 
,'' 
constraints(( 
:(( 
table(( "
=>((# %
{)) 
table** 
.** 

PrimaryKey** $
(**$ %
$str**% 5
,**5 6
x**7 8
=>**9 ;
x**< =
.**= >
Id**> @
)**@ A
;**A B
}++ 
)++ 
;++ 
migrationBuilder-- 
.-- 
CreateTable-- (
(--( )
name.. 
:.. 
$str.. 
,.. 
columns// 
:// 
table// 
=>// !
new//" %
{00 
Id11 
=11 
table11 
.11 
Column11 %
<11% &
Guid11& *
>11* +
(11+ ,
type11, 0
:110 1
$str112 8
,118 9
nullable11: B
:11B C
false11D I
)11I J
,11J K
SourceDeviceMacId22 %
=22& '
table22( -
.22- .
Column22. 4
<224 5
string225 ;
>22; <
(22< =
type22= A
:22A B
$str22C I
,22I J
nullable22K S
:22S T
false22U Z
)22Z [
,22[ \
Severity33 
=33 
table33 $
.33$ %
Column33% +
<33+ ,
string33, 2
>332 3
(333 4
type334 8
:338 9
$str33: @
,33@ A
nullable33B J
:33J K
false33L Q
)33Q R
,33R S
Message44 
=44 
table44 #
.44# $
Column44$ *
<44* +
string44+ 1
>441 2
(442 3
type443 7
:447 8
$str449 ?
,44? @
nullable44A I
:44I J
false44K P
)44P Q
,44Q R
Comment55 
=55 
table55 #
.55# $
Column55$ *
<55* +
string55+ 1
>551 2
(552 3
type553 7
:557 8
$str559 ?
,55? @
	maxLength55A J
:55J K
$num55L O
,55O P
nullable55Q Y
:55Y Z
false55[ `
)55` a
,55a b
AcknowledgedFrom66 $
=66% &
table66' ,
.66, -
Column66- 3
<663 4
string664 :
>66: ;
(66; <
type66< @
:66@ A
$str66B H
,66H I
nullable66J R
:66R S
false66T Y
)66Y Z
,66Z [
RaisedAt77 
=77 
table77 $
.77$ %
Column77% +
<77+ ,
DateTime77, 4
>774 5
(775 6
type776 :
:77: ;
$str77< B
,77B C
nullable77D L
:77L M
false77N S
)77S T
,77T U
IsAcknowledged88 "
=88# $
table88% *
.88* +
Column88+ 1
<881 2
bool882 6
>886 7
(887 8
type888 <
:88< =
$str88> G
,88G H
nullable88I Q
:88Q R
false88S X
)88X Y
,88Y Z
AcknowledgedAt99 "
=99# $
table99% *
.99* +
Column99+ 1
<991 2
DateTime992 :
>99: ;
(99; <
type99< @
:99@ A
$str99B H
,99H I
nullable99J R
:99R S
true99T X
)99X Y
,99Y Z

ResolvedAt:: 
=::  
table::! &
.::& '
Column::' -
<::- .
DateTime::. 6
>::6 7
(::7 8
type::8 <
:::< =
$str::> D
,::D E
nullable::F N
:::N O
true::P T
)::T U
,::U V
StateId;; 
=;; 
table;; #
.;;# $
Column;;$ *
<;;* +
int;;+ .
>;;. /
(;;/ 0
type;;0 4
:;;4 5
$str;;6 ?
,;;? @
nullable;;A I
:;;I J
false;;K P
);;P Q
}<< 
,<< 
constraints== 
:== 
table== "
=>==# %
{>> 
table?? 
.?? 

PrimaryKey?? $
(??$ %
$str??% 0
,??0 1
x??2 3
=>??4 6
x??7 8
.??8 9
Id??9 ;
)??; <
;??< =
table@@ 
.@@ 

ForeignKey@@ $
(@@$ %
nameAA 
:AA 
$strAA =
,AA= >
columnBB 
:BB 
xBB  !
=>BB" $
xBB% &
.BB& '
StateIdBB' .
,BB. /
principalTableCC &
:CC& '
$strCC( 5
,CC5 6
principalColumnDD '
:DD' (
$strDD) -
,DD- .
onDeleteEE  
:EE  !
ReferentialActionEE" 3
.EE3 4
RestrictEE4 <
)EE< =
;EE= >
}FF 
)FF 
;FF 
migrationBuilderHH 
.HH 
CreateIndexHH (
(HH( )
nameII 
:II 
$strII )
,II) *
tableJJ 
:JJ 
$strJJ 
,JJ  
columnKK 
:KK 
$strKK !
)KK! "
;KK" #
}LL 	
	protectedOO 
overrideOO 
voidOO 
DownOO  $
(OO$ %
MigrationBuilderOO% 5
migrationBuilderOO6 F
)OOF G
{PP 	
migrationBuilderQQ 
.QQ 
	DropTableQQ &
(QQ& '
nameRR 
:RR 
$strRR "
)RR" #
;RR# $
migrationBuilderTT 
.TT 
	DropTableTT &
(TT& '
nameUU 
:UU 
$strUU 
)UU 
;UU  
migrationBuilderWW 
.WW 
	DropTableWW &
(WW& '
nameXX 
:XX 
$strXX #
)XX# $
;XX$ %
}YY 	
}ZZ 
}[[ 